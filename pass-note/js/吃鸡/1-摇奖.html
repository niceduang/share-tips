<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	<script type="text/javascript">
		// 运动事件监听
		if (window.DeviceMotionEvent) {
		    window.addEventListener('devicemotion',deviceMotionHandler,false);
		}

		// 获取加速度信息
		// 通过监听上一步获取到的x, y, z 值在一定时间范围内的变化率，进行设备是否有进行晃动的判断。
		// 而为了防止正常移动的误判，需要给该变化率设置一个合适的临界值。
		var SHAKE_THRESHOLD = 4000;
		var last_update = 0;
		var x, y, z, last_x = 0, last_y = 0, last_z = 0;
		function deviceMotionHandler(eventData) {
	        var acceleration =eventData.accelerationIncludingGravity;
	        var curTime = new Date().getTime();
	        if ((curTime - last_update)> 30) {
	            var diffTime = curTime -last_update;
	            last_update = curTime;
	            x = acceleration.x;
	            y = acceleration.y;
	            z = acceleration.z;
	            var speed = Math.abs(x +y + z - last_x - last_y - last_z) / diffTime * 10000;
	            if (speed > SHAKE_THRESHOLD) {
	                alert("你中奖啦！");
	            }
	            last_x = x;
	            last_y = y;
	            last_z = z;
	        }
		}

		// shake-game
		function createGame(data){
			function Game(data){
				this.data = data || [];
				// 随机打乱数组
				this.dataRandom = this.data.slice(0).sort(this.getRandomData);
				this.init();
			}
			Game.prototype = {
				init: function(){
					this.iIndex = 0;
					// 是否已经获奖
					this.status = false;
					this.timer = null;
					this.speed = 500;
				},
				start: function(){
					console.log(this.data);
					console.log(this.dataRandom);
					this.changeImg(this.iIndex);
					this.stop();
					this.timer = setInterval(function(){
						this.next();
					}.bind(this),this.speed);
				},
				prev: function(){
					this.iIndex--;
					this.changeImg(this.iIndex);
				},
				next: function(){
					this.iIndex++;
					this.changeImg(this.iIndex);
				},
				getRandomData: function(){
					return Math.random()>0.5 ? -1 : 1;
				},
				changeImg: function(m){
					this.iIndex = m;
					this.iIndex %= this.data.length;
					this.iIndex = this.iIndex<0 ? (this.iIndex+this.data.length):this.iIndex;
					console.log(this.dataRandom[this.iIndex]);
				},
				stop: function(){
					this.timer && clearInterval(this.timer);
				},
				setResult: function(m){
					this.status = true;
					// 如果摇奖之后依然播放奖池，就不用停止奖池改变
					this.stop();
					var _src = this.data[m];
					// 设置奖池停止在获奖位置
					// 获奖结果展示 
					console.log(_src);
				}
			}
			return new Game(data);
		}
		var data = ['1.jpg','2.jpg','3.jpg','4.jpg','5.jpg'];
		var game = createGame(data);
		game.start();
		document.addEventListener('click',function(){
			if (game.status) {
				alert('您已经摇过奖了~');
				return;
			}
			var randomNum = Math.floor(Math.random()*data.length);	// 随机设置获奖所属下标，开发时候删除
			console.log(randomNum);
			game.setResult(randomNum);
		},false);
	</script>
</body>
</html>