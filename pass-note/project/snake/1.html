<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>snake</title>
	<style type="text/css">
		*{margin: 0;padding: 0;}
		.stage{
			position: relative;
			width: 500px;
			height: 300px;
			margin: 0 auto;
			border: 1px solid #000;
		}
		.stage div{
			position: absolute;
			left: 0;top: 0;
			width: 10px;
			height: 10px;
			background-color: #000;
		}
		.stage div::after{
			content: "";
			position: absolute;
			left: 3px;top: 50%;right: 3px;
			border-bottom: 1px solid #fff;
		}
	</style>
</head>
<body>
	<div class="stage"></div>
	<script src="http://ossweb-img.qq.com/images/js/jquery/jquery-1.11.3.min.js"></script>
	<script type="text/javascript">
		var $stage = $('.stage');
		var w = 10;
		var Col = 300/10;
		var Row = 500/10;
		var aSnake = [];
		var iSpeed = 150;

		// 初始化蛇身体
		initSnake();
		function initSnake(){
			for (var i = 0; i < 3; i++) {
				var $div = $('<div></div>');
				$stage.append($div);
				aSnake.push({"x":3+i,"y":0,"ele":$div,"dir":"l","type":"snake"});
				initPos(aSnake[i]);
			}
		}
		// 设置蛇坐标
		function initPos(obj){
			obj.ele.css({
				"left": obj.x*w,
				"top": obj.y*w
			});
		}
		// 蛇运动
		var dir = "l";
		var timer = setInterval(snakeMove,iSpeed);
		function snakeMove(){
			// 移动蛇身子
			for (var i = aSnake.length - 1; i > 0; i--) {
				aSnake[i].x = aSnake[i-1].x;
				aSnake[i].y = aSnake[i-1].y;
				aSnake[i].dir = aSnake[i-1].dir;
			}
			// 移动蛇头
			switch(dir){
				case "l" :
					aSnake[0].x--;
					break;
				case "r" :
					aSnake[0].x++;
					break;
				case "t" :
					aSnake[0].y--;
					break;
				case "b" :
					aSnake[0].y++;
					break;
			}
			// 判断蛇有没有撞墙
			// if (aSnake[0].x<0||aSnake[0].y<0||aSnake[0].x>Row-1||aSnake[0].y>Col-1) {
			if (aSnake[0].x<0||aSnake[0].y<0||aSnake[0].x>=Row||aSnake[0].y>=Col) {
				timer && clearInterval(timer);
				console.log('撞墙了');
				return;
			}
			// 判断蛇有没有撞到自己, i 从 1 开始
			for (var i = 1; i < aSnake.length; i++) {
				if (aSnake[0].x == aSnake[i].x&&aSnake[0].y == aSnake[i].y) {
					timer && clearInterval(timer);
					console.log('撞到了自己');
					return;
				}
			}
			// 判断是否吃到了食物
			if (aSnake[0].x==aFood[0].x&&aSnake[0].y==aFood[0].y) {
				eatNum++;
				console.log('吃了'+eatNum+'个');
				aSnake.splice(aSnake.length-1,0,aFood[0]);
				// aFood.shift();
				aFood = [];
				createFood();
			}
			// 数组操作完设置一次位置
			for (var i = 0; i < aSnake.length; i++) {
				initPos(aSnake[i]);
			}
		}
		// 键盘控制方向
		$(document).on('keydown',keyHandle);
		function keyHandle(e){
			var code = e.keyCode;
			switch(code){
				case 37:
					dir = "l";
					aSnake[0].dir=dir;
				break;
				case 38:
					dir = "t";
					aSnake[0].dir=dir;
				break;
				case 39:
					dir = "r";
					aSnake[0].dir=dir;
				break;
				case 40:
					dir = "b";
					aSnake[0].dir=dir;
				break;
			}
		}

		// 食物
		var eatNum = 0;
		var aFood = [];
		var createFood = function(){
			var x = parseInt(Math.random()*Row);
			var y = parseInt(Math.random()*Col);
			// 判断新生食物是否与蛇重叠
			for (var i = 0; i < aSnake.length; i++) {
				if (aSnake[i].x==x&&aSnake[i].y==y) {
					createFood();
					return;
				}
			}
			var $div = $('<div></div>')
			$stage.append($div);
			$div.css({
				"left":x*w,
				"top":y*w,
			});
			aFood.push({"x":x,"y":y,"ele":$div,"type":"food"});
		} 
		createFood();
	</script>
</body>
</html>